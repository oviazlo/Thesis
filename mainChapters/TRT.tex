\chapter{TRT}
\label{chap:TRT}

In the end of the Rin-1 period some of TRT straws start to leak.


In the \SectionRef{???} overview of the TRT read-out electronics is done with focus on front end electronics, becuase 


\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{TRT/Xe_Ar_map_2015.png}
  \label{fig:sub1}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\linewidth]{TRT/Xe_Ar_map_2016.png}
  \label{fig:sub2}
\end{subfigure}
\caption{TRT gas configuration used during 2015 (left) and 2016 (right) data taking years.}
\label{fig:gas_gain}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=.6\textwidth]{TRT/TRT_improvement_momentum_resolution.png}
\caption{ 
Momentum resolution determined from cosmic ray data, taken in 2008, as a function of transverse momentum~\cite{Aad:2010bx}.
The resolution are shown for simulated full ID tracks (stars), full ID tracks (solid triangles) and silicon-only tracks (open triangles).
}
\label{fig:gas_gain}
\end{figure}





\section{Description of the straw}
% - main idea of signal detection 
% - material of the straw
% - gas mixture and all properties

The main basic elements of the TRT is proportional drift tubes, hereafter called straw tubes or simply straws.
Tubes need to have good electrical (the cathode resistance has to be as low as possible) and mechanical (to avoid gas leaks) properties.
Geometrical factor has to be taken into account as well. Large straws provide better hit efficiency; small straws provide small drift time (time to collect electrons in the tube).
Another crucial requirement was a limit on thickness of the tubes. 
In order to let low-energy transition radiation photons (created by electrons passing radiators) go through and be adsorbed in the gas, tube walls need to be as thin as possible.

All these requirements were considered during the design face and most optimal choise was used.
Tube size is 4 mm in diameter. Walls are made from two layers of multilayer film. Section of the straw wall is shown in \FigureRef{fig:straw_wall_section}.
Two layers consist from 6 $\mu$m thick carbon-polyimide layer, which protects 0.2 $\mu$m thick Al layer, which is coated on 25 $\mu$m Kapton film.
These two layers were placed back to back and were glued by 5 $\mu$m thick polyurethane layer.
Mechanically, tubes were supported by carbon fiber bundles, which were placed from four sizes around each tube.
The anode is 30 $\mu$m diameter tungsten wire coated with 0.6-0.7 $\mu$m layer of gold.

\begin{figure}
\centering
\includegraphics[width=.4\textwidth]{TRT/straw_cross_section.png}
\caption{ 
Section of the TRT straw tube wall.
}
\label{fig:straw_wall_section}
\end{figure}

Active detector volume of straw is gas mixture which is flushed through the tubes with help of the gas system.
% TODO make similar chapter about transiiton radiation, same as Alex
This mixture was carefully chosen in order to be safe to use, compatible with detector materials and to not have dissociation products (after electron avalanche) with aggressive properties.
Higher electron drift velocity is preferred as well as wide operating plateau (range of high voltage were straws works in the proportional regime). Latter is important in order to have 
safety margin in case high voltage has to be changed to correct for temperaature variations, to enhance signal to noise ratio or to adjust for heavy-ionizing particle effect~\cite{Abat:2008zza}.
In order to have enough adsorb efficiency of transition radiation photons main component of the mixture has to be a noble gas [???WHY???] which are inert and have 
large photo-adsorbtion cross sections.
Target energy of transition radiation photons to be absorbed in order to make electron identification is in range 1-20 keV.
In \FigureRef{fig:absorption_lenght} absorption lenghts are shown for four most heavy noble gases.
As one can see the best choice would be the Radon gas, but due to its radioactivity it can not be used.
Next candidate was Xenon and it was choosen to be a main gas component.
Because of big cost of Xenon it was decided for all tests and during commisioning phase before pp collisions to use Argon gas. That is why read-out electronics were
designed with possibility to work with Argon- and Xenon-based gas mixtures, as described in \SectionRef{subsec:front_end_electronics}.

\begin{figure}
\centering
\includegraphics[width=.7\textwidth]{TRT/absorption_lenght_noble_gases.png}
\caption{ 
  Absorption lenght as a function of photon energy for heaviest noble gases. Data was taken from~\cite{Hubbell:353989}.
}
\label{fig:absorption_lenght}
\end{figure}

[TODO] Explanation of the CO$_{2}$ and $O_2$ quenching additions.

\begin{figure}
\centering
\includegraphics[width=.5\textwidth]{TRT/gas_gain_Xe_Ar.png}
\caption{ 
Straw gas gain as a function of high voltage for different gas mixtures. Taken from~\cite{Abat:2008zza}.
}
\label{fig:gas_gain}
\end{figure}


\section{Description of the Front-End read-out electronics}
\label{subsec:front_end_electronics}


Full description of TRT read-out chain can be found in~\cite{TRT_electronics}.
In this sub-section main focus will lay on Front End electronics, which take raw signals from the straws as input and return digitized information of 24+3 bits.
Signal is read fromm 


\begin{figure}
\centering
\includegraphics[width=.7\textwidth]{TRT/electronics.png}
\caption{ 
 Schematic representation of the TRT readout electronic.
}
\label{fig:electronics}
\end{figure}



\section{Introduction}
\label{sec:TRT:introduction}




The ATLAS Transition Radiation Tracker (TRT) is the outermost of the three tracking subsystems of the ATLAS Inner Detector. 
ATLAS is one of two general-purpose detectors built for the Large Hadron Collider at CERN.

% About TRT
The TRT contains $\sim$300000 thin-walled proportional-mode drift tubes providing on average 30 two-dimensional 
space points with $\sim$130 $\mu m$ resolution for charged particle tracks with |$\eta$| < 2 and $p_T$ > 0.5 GeV~\cite{Abat:2008zza,Abat:2008zzb,Abat:2008zz}.
Along with continuous tracking, the TRT provides electron identification capability through the detection of transition radiation X-ray photons.

% Implementation of Argon simulation
Till now TRT simulation code supported only Xenon based gas-mixtures as active gas in the tubes. 
Current study is focused on implementation of simulation of Argon based gas-mixture, 
which was used for a few runs of data taking in 2013 in a few TRT modules.

% Performance study
% Performance study of the TRT using Argon and Xenon based gas-mixtures will be presented.
% Hit and track parameters, such as hit reconstruction efficiency, residuals, track momentum resolution and extension fraction
% will be shown for both gas-mixtures and compared to Monte Carlo simulation.

Current note are dedicated to the performance study of Transition Radiation Tracker (TRT) of ATLAS detector on hit and track parameter with focus on active gas mixture.
It consist from technical description of implementation of Argon-based active gas mixture to the TRT Digigtization package of ATHENA framework and performance study itself. 
Aim of current study was to investigate scenario when instead of standart Xenon-based mixture Argon-based mixture will be used in some part of detector. Main parameters of interest
were hit residuals, track extension fraction ???
Motivation for current study was leakages in tubes ???





\begin{figure}
\begin{center}
 \includegraphics[width=0.35\columnwidth]{TRT/fromPoster/driftTube.pdf}
\caption{\label{fig:clusterDriftInTube} Example of ionisation and electron drift in a straw tube. Taken from ~\cite{Cwetanski:962570}. 
	  [Peter Cwetanski thesis ???]}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
 \includegraphics[width=0.6\columnwidth]{TRT/fromPoster/TRTdigi4.pdf}
\caption{\label{fig:pulseDigitization} Illustration of the digitization of a TRT low threshold signal.}
\end{center}
\end{figure}



\section{Argon implementation into Digitization package}
\label{sec:TRT:argonImpl}


\subsection{Simulation and Digitization of TRT}

To simulate propagation of charged partiles trough TRT two steps are using: Simulation and Digitization. 
Roughly speaking on simulation step .... and digitization step should take care of processing all physical energy contributions which were left by those particles.
But due to the fact that standart-configured GEANT4 package make poor job on calculating energy deposition in thin layer of gas in tubes it was decided to take care 
of this in Digitization step. So from simulation step only list of hits in TRT are used when energy deposition to the gas inside the tubes are calculated in Digitization step.


\begin{figure}
\begin{center}
 \includegraphics[width=0.59\columnwidth]{TRT/fromPoster/ArgonModules2013.png}
\caption{\label{fig:argonModulesIn2013} Detector modules which were operated with Argon gas mixture during 2013 runs}
\end{center}
\end{figure}





\subsection{Implementation of mixed condition}
TRT detector was originally designed as an homogenous detector and it was planned that only one gas mixture will be used in the all straws. 
Digitization code, as all physics codes, was written with an idea to be as simple as possible, that's why it was designed with assumption that all straws will be simulated with only one type of gas mixture.
But after leakeges appears at the end of the Run 1, it become higly probable, that TRT may be run in mixed condition, when some part of straws will be run with one gas and other part - with another. That's why 
possibility to digitize mixed condition become essential feature of the code. 

To make it work new (to the digitization code) Argon gas mixture was introduced and following simulated detector/electronics parameters as low/high treshold and shaping functions were duplicated.
Digitization of the TRT hits are done straw by straw and in the beginning of the straw loop flag \mbox{ ``isArgonStraw''} is read from the COOL database. This flag represent is current straw contain Argon or Xenon based 
gas mixture. The straw map lays under \mbox{/TRT/Cond/StatusHT} COOL folder, and one need to specify dedicated tag to make mixed Ar/Xe digitization.
According to this flag relevant thresholds and shaping function are picked up and used during digitization following straw. 


\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/mapXY_barA.pdf}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/mapXY_endA.pdf}
\end{subfigure}

\caption{$T_{0}$ calibration constants obtained for MC simulation for Barrel A (left) and End-cap A (right) detectors for the mixed Xenon-Argon condition. 
	  Modules with Argon gas have different $T_{0}$ calibration constants.}
  \label{fig:t0_mixed_condition}
\end{figure}



Also two flags which provide simple possibility to change active gas mixture from default one (Xenon) to the optional (Argon) for all straws were implemented. These are:
\begin{itemize}
 \item UseArgonStraws
 \item UseConditionsHTStatus
\end{itemize}

First flag says that we want to use optional gas in some part or in full detector. If it is false - default Xenon gas will be used despite of the second flag. 
Second flag says do we want to read straw map from COOL database or not.
If it is false full Argon geometry condition will be run. Example of usage these flags can be found at [???].

Points related to the actual gas mixture implementation are described at the next subsections.

\subsection{Simulation of energy deposition to the gas in straw: PAI tool}


Average ionization energy. Argon gas was studied before   [Explain how I count it from table from Perer Cwetanski thesis, see presentation by Andrew]


%%% Average ionization energy. %%%
%%% explanation how does average inonization energy effect simulation and in which steps (Andrew presentation).
%%% 


\begin{itemize}
 \item Average ionization energy
 \item Primary electron survival probability (???)
 \item ???
\end{itemize}



\begin{figure}
\begin{center}
 \includegraphics[width=0.59\columnwidth]{TRT/meanFreePath.eps}
\caption{\label{fig:meanFreePath} ???}
\end{center}
\end{figure}


\subsection{Simulation of timing variables}

To simulate drift time of the primary cluster of electrons from place of origin to the wire Athena package 
use empirically measured (TODO not from Garfield?) tables of dependence of drift distance versus drift time (so called RT tables). 
Due to the facts that drift velocity depends from magnetic field in the tube and field itself is not homogenous within detector 
there are two sets of tables: one which corespond to the maximum magnetic field (2T for the ATLAS experiment) and another - without magnetic field. To get RT table
for some specific value of magnetic field following interpolation formula are used:

\begin{displaymath}
    RT(B_{eff}) = (RT_{MAX} - RT_{WO}) \cdot \dfrac{B_{eff}^2}{B_{max}^2} + RT_{WO}
\end{displaymath}

[TODO] explain variables in formula above.

That's why to implement Argon gas mixture two such tables were added to the TRT digitization package.
% \\ \mbox{InDetSimUtils/TRT$\_$DriftTimeSimUtils} package (\mbox{TRT$\_$BarrelDriftTimeData.cxx} file). 
These tables were obtained from Garfield simulation [reference ???].
% by Konstantin Vorobyev 
The comparison of Argon and Xenon RT tables are shown in figure \ref{fig:rt_comp}. 
Also scaled Xenon RT distribution are shown to highlight different shape of distributions for Argon and Xenon gases.


\begin{figure}
\begin{center}
 \includegraphics[width=0.99\columnwidth]{TRT/rt_comp.png}
\caption{\label{fig:rt_comp} }
\end{center}
\end{figure}

Another variable which was implemented for Argon mixture is signal shaping function. 

Different active gases give diferent signals. These signals differs in leading front, amplitude and shape and size of tail. But TRT electronics expect to recieve signal with specific configuration.
That's why ASDBLR chip~\cite{TRT_electronics} convulve signal from straw with dedicated shaping function to produce final signal which will be acceptable by further chain of electronics. This leads to the fact that we need
to have different shaping functions for Argon and Xenon based mixtures.
% TODO do I want to include this cite???
% ~\cite{Vorobev_private}. 
Due to the fact, that datataking ASDBLR chip was used different shaping function for Xenon and Argon 
digitization code should also provide such kind of functionality. 

\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/rt_FinalXenon.eps}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/rt_FinalArgon.eps}
\end{subfigure}

\caption{Track to wire distance in Xenon (left) and Argon (right) straws in Endcap detectors.}
  \label{fig:RT_xenon_argon}
\end{figure}

Shaping functions are used in the simulation of electronics. It effect simulation of discriminator responce and accordingly TRT bit pattern.
Shaping function are stored at \mbox{TRTDigSettings.amplitudes} file in the \mbox{TRT$\_$Digitization} package. During digitization according to ``isArgonStraw'' flag relevant shaping function is used. 
All available shaping functions are shown in figure \ref{fig:shaping}.

\begin{figure}
\begin{center}
 \includegraphics[width=0.69\columnwidth]{TRT/shaping.eps}
\caption{\label{fig:shaping} Argon low threshold shaping function in comparison with Xenon low and high treshold shaping functions}
\end{center}
\end{figure}

% TODO new text starts from here [August 2016]:




\subsection{Noise simulation}

% TODO I am not sure if it is this note....
Noise note:~\cite{Kittelmann:987854}

[TODO] see comments in TRTDigCondFakeMap::setStrawStateInfo() function.


\begin{equation}
 LT_i = A_i \cdot (\alpha + \beta \cdot ErfcInv(\gamma \cdot f_i)) %TODO make EffcInv as in Noise note (eq. 2)
\end{equation}

%%% OR 
%%% 
%%% just say that according to the Noise revision note LT_i is proportional to the noise signal amplitude
%%%

% LTi = Ai · ( +  · ErfcInv(  · fi)) ,

%%% formula from ``Revision of Noise and Threshold Description in MC Simulation'':
%%% --> averagenoiseampforstrawlength = ( ( (3000.-1350.)/(70*CLHEP::cm) ) * strawlength + 1350.0 ) / 3000.0;
%%% according to Anatoli, we need to scale noise amplitude for Argon straws by factor LT_argon/LT_xenon
%%% --> scaleAmplitudeFactor = m_settings->lowThreshold(true)/m_settings->lowThreshold(false);
%%% --> averagenoiseampforstrawlength *= scaleAmplitudeFactor; 
%%% Found in file: ./InDetDigitization/TRT_Digitization/src/TRTDigCondFakeMap.cxx *

%%% WARNING Sasha: this function used hardcoded noise signal shape in TRTSignalShape.cxx line 58.
%%% WARNING Sasha: should noise be different for Argon? should I change something here?  
%%% WARNING Sasha: for now I will assume that it is okay for Argon
%%% Found in file: ./InDetDigitization/TRT_Digitization/src/TRTNoise.cxx *

\begin{figure}
\begin{center}
 \includegraphics[width=0.79\columnwidth]{TRT/grBMPos_mod.pdf}
\caption{ Position residual width as a function of the TRT module number in the Barrel detector. Red points correspond to simulation of TRT detector
using Argon-based mixture in all straws, black points correspond to Xenon-based mixture while green point correspond to the mixed detector condition
which was used during ??? data taking period. Modules with Argon mixture in mixed condition can be clearly seen.}
\label{fig:meanFreePath}
\end{center}
\end{figure}

\section{Tracking performance study}
\label{sec:TRT:trackPerf}

During 2013 year a few runs with Argon gas mixture in the detetector was done in order to investigate performace of the detector with Argon as active gav.
Four of 32 phi sectors in the inner layer for the barrels and one of 14 wheel in the endcap A were filled with Argon mixture while other sectors were operating 
with usual Xenon mixture (as it shown in \FigureRef{fig:argonModulesIn2013}). Used Argon mixture had following cofiguration: Ar/CO$_{2}$/O$_{2}$ (70$\%$/27$\%$/3$\%$). In order to operate it high voltage had
to be higher [??? explain why HV has to be different] and it was 1470 V.




\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/resFitXenon.eps}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/resFitArgon.eps}
\end{subfigure}

% \includegraphics[width=0.75\textheight]{monoW/kinematics_simplifiedSChannel_EFT_Wprime.png}
\caption{Position residuals. Barrel A.}
  \label{fig:resFit}
\end{figure}





\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/hit_eff_rtrack_bar_xenon_region.eps}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/hit_eff_rtrack_bar_argon_region.eps}
\end{subfigure}

% \includegraphics[width=0.75\textheight]{monoW/kinematics_simplifiedSChannel_EFT_Wprime.png}
\caption{Hit reconstruction straw efficiency as a function of track to wire distance.}
  \label{fig:hit_eff_rtrack_bar}
\end{figure}

As was mentioned above electrons drift faster in the Argon-based gas mixture than Xenon one, which can be observed in the track to wire distance
distributions shown in \FigureRef{fig:RT_xenon_argon}. 
This results that timing calibration constants have to be significantly different 
for Argon and Xenon straws which can be seen in \FigureRef{fig:t0_mixed_condition}. 


\begin{figure}
\begin{center}
 \includegraphics[width=0.9\columnwidth]{TRT/fromPoster/track_ext_frac_eta.eps}
\caption{Track extension fraction as a function of $\eta$ for Xenon and Argon active gas mixture obtained with MC simulation.}
\label{fig:meanFreePath}
\end{center}
\end{figure}



Due to a lower threshold a larger hit reconstruction efficiency is seen for Argon straws. This leads to a
larger number of hits per track and larger fraction of precision hits. Also position residuals are seen to be 
slightly larger. All these observations indicate that additional threshold tuning is required.

[TODO] think which plots can be added to this section.

\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/xenon_nHitsPerTrack_vs_phi.eps}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/argon_nHitsPerTrack_vs_phi.eps}
\end{subfigure}

\caption{Number of hits per track. MC simulation.}
  \label{fig:nPrecHitsPerTrack}
\end{figure}


\begin{figure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/xenon_precHitFracPerTrack_vs_phi.eps}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{TRT/fromPoster/argon_precHitFracPerTrack_vs_phi.eps}
\end{subfigure}

\caption{Precision hit fraction. MC simulation.}
  \label{fig:precHitFracPerTrack}
\end{figure}

